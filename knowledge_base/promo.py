promotions = {
    "promo_edc_cashback": {
        "description": "Promo Cashback EDC Bank Nagari",
        "periode": "Agustus-Desember 2025 (berakhir 25 Desember 2025)",
        "start_date": "2025-08-01",
        "end_date": "2025-12-25",
        "benefits": [
            "Mendapatkan cashback Rp 10.000 per transaksi yang memenuhi syarat"
        ],
        "requirements": [
            "Program hanya berlaku untuk 1 (satu) kali transaksi oleh 1 (satu) rekening per hari",
            "Tidak berlaku kelipatan/pemecahan transaksi",
            "Minimal belanja sesuai kategori program",
            "Transaksi melalui EDC Bank Nagari"
        ],
        "programs": [
            {
                "nama_promo": "Promo EDC Market",
                "minimal_belanja": "Rp 150.000,-",
                "cashback_nasabah": "Rp 10.000,-",
                "reward_merchant": "Rp 2.000,-"
            },
            {
                "nama_promo": "Promo EDC Style",
                "minimal_belanja": "Rp 150.000,-",
                "cashback_nasabah": "Rp 10.000,-",
                "reward_merchant": "Rp 2.000,-"
            },
            {
                "nama_promo": "Promo EDC Beauty",
                "minimal_belanja": "Rp 150.000,-",
                "cashback_nasabah": "Rp 10.000,-",
                "reward_merchant": "Rp 2.000,-"
            },
            {
                "nama_promo": "Promo EDC Elektro",
                "minimal_belanja": "Rp 200.000,-",
                "cashback_nasabah": "Rp 10.000,-",
                "reward_merchant": "Rp 2.000,-"
            },
            {
                "nama_promo": "Promo EDC Kuliner",
                "minimal_belanja": "Rp 100.000,-",
                "cashback_nasabah": "Rp 10.000,-",
                "reward_merchant": "Rp 2.000,-"
            },
            {
                "nama_promo": "Promo EDC Serba Serbi",
                "minimal_belanja": "Rp 100.000,-",
                "cashback_nasabah": "Rp 10.000,-",
                "reward_merchant": "Rp 2.000,-"
            }
        ]
    },
    "nagari_merdeka": {
        "description": "Promo Nagari Merdeka HUT 80 Tahun 2025",
        "periode": "1-31 Agustus 2025",
        "start_date": "2025-08-01",
        "end_date": "2025-08-31",
        "benefits": [
            "Mendapatkan reward sampai dengan Rp 2.000.000",
            "Bunga turun",
            "Diskon biaya pencairan pinjaman/pembiayaan"
        ],
        "requirements": [
            "Pinjaman/Pembiayaan untuk ASN, Pegawai, dan Pensiunan",
            "Berlaku untuk pengajuan baru, Top Up/Take Over"
        ]
    },
    "sikoci_cuan": {
        "deskripsi": "Promo Sikoci Cuan Bank Nagari adalah promo yang memberikan kesempatan kepada nasabah untuk menabung di Tabungan Sikoci dan mendapatkan hadiah langsung dengan total nilai hingga ratusan juta rupiah.",
        "periode": "Sampai dengan 31 Desember 2025",
        "start_date": "2025-08-01",
        "end_date": "2025-12-31",
        "benefits": [
            "Kesempatan mendapatkan hadiah langsung hingga ratusan juta rupiah"
        ],
        "requirements": [
            "Jangka waktu tabungan 3 (tiga) bulan atau 6 (enam) bulan",
            "Pencairan tabungan dilakukan pada tahun 2026"
        ]
    },
    "gebyar_hadiah_tabungan": {
        "description": "Alek Sikoci kini menjadi Undian Tabungan Berhadiah Bank Nagari Hadiah Lebih Besar dan Waktu yang Diperpanjang! Periode Diperpanjang sampai dengan 31 Desember 2024",
        "hadiah": [
            "Grand Prize 1 Uni Toyota Fortuner VRZ 4x2 A/T / M/T (harga off the road)",
            "Hadiah Utama 1 Unit New Expander MT / CVT",
            "Hadiah Utama 1 Unit Brio Satya",
            "Hadiah I 1 Unit NMAX (3 Orang)",
            "Hadiah II Umroh (5 Orang)",
            "Hadiah III 1 Unit Sepeda Motor Vario 125 (harga off the road) (56 Orang)",
            "Hadiah IV Emas masing-maisng 2,5 gram (10 Orang)"
        ],
        "requirements": [
            "Nasabah Perorangan",
            "Minimal Saldo periode sebesar Rp.1.000.000,-",
            "Setiap tabungan kelipatan Rp. 250.000,- akan mendapatkan 1 (satu) poin undian",
            "Untuk Tabungan Sikoci dan Tabungan Sikoci Syariah",
            "Semakin besar poin undian akan semakin besar kesempatan mendapatkan hadiah",
        ]
    },
    "kpr_berhadiah_langsung": {
        "description": "Program KPR dan Nagari Griya Madani (NGM) Berhadiah Langsung berlaku dari 01 Januari 2025 hingga 31 Desember 2025.",
        "benefits": [
            "Mendapatkan hadiah langsung peralatan rumah tangga",
            "Harga hadiah sampai dengan Rp. 4.000.000,-",
            "Pajak hadiah sudah termasuk dalam promo"
        ],
        "requirements": [
            "Berlaku untuk kredit/pembiayaan dengan jangka waktu minimal 36 bulan",
            "Minimal realisasi kredit/pembiayaan sebesar Rp 150.000.000,-",
            "Penggunaan untuk pembelian Rumah/Ruko/Toko sesuai ketentuan KPR/NGM",
            "Take over bank lain (Home Power untuk pelunasan pinjaman bank atau lembaga keuangan lainnya)",
            "Renovasi rumah sendiri"
        ]
    },
    "hangout_weekend_ollin": {
        "description": "Promo QRISperience Hangout Weekend Bareng Ollin di cafe/resto pilihan setiap Sabtu dan Minggu dengan pembayaran QRIS Ollin by Nagari.",
        "periode": "Sampai dengan 31 Oktober 2025",
        "start_date": "2025-08-01",
        "end_date": "2025-10-31",
        "benefits": [
            "Cashback hingga Rp 5.000"
        ],
        "requirements": [
            "Transaksi minimal Rp 150.000",
            "Satu kali transaksi per rekening per hari",
            "Tidak berlaku kelipatan",
            "Pembayaran menggunakan QRIS Ollin by Nagari",
            "Berlaku untuk 10.000 transaksi pertama"
        ],
        "merchants": "Daftar lengkap merchant dapat dilihat di: https://banknagari.co.id/produk?page=t3bhm73CneYAfD1kb38MNw%3D%3D"
    },
}

from typing import Optional, Dict, Any, List

# Asumsi: dict `promotions` sudah didefinisikan di file ini (di atas fungsi ini)

def _pretty_key(s: str) -> str:
    return s.replace("_", " ").title()

def _available_fields(p: Dict[str, Any]) -> str:
    return ", ".join(p.keys())

def _format_list(items: List[Any]) -> str:
    if not items:
        return "-"
    if all(isinstance(i, dict) for i in items):
        lines = []
        for item in items:
            parts = [f"{_pretty_key(str(k))}: {v}" for k, v in item.items()]
            lines.append("- " + ", ".join(parts))
        return "\n".join(lines)
    return "- " + "\n- ".join(str(i) for i in items)

def _list_all_promos() -> str:
    if not promotions:
        return "Belum ada promo yang terdaftar."
    names = [_pretty_key(k) for k in promotions.keys()]
    return "Berikut daftar promo yang tersedia:\n- " + "\n- ".join(names)

def get_promo_info(promo_key: Optional[str] = None, info_type: Optional[str] = None) -> str:
    """
    Ambil info promo.
    - Jika promo_key dan info_type kosong → kembalikan daftar semua promo.
    - Jika info_type kosong → tampilkan deskripsi (jika ada) + daftar field yang tersedia.
    - Menangani list/dict/string secara rapi.
    - Khusus field 'programs' (EDC), diformat ringkas.
    """
    # 1) Tanpa parameter → list semua promo
    if not promo_key and not info_type:
        return _list_all_promos()

    # 2) Ambil promo (andalkan canonical key dari preprocessing)
    if not promo_key:
        return "Mohon sebutkan nama promo yang ingin kamu lihat."

    key = promo_key.lower().strip()
    promo = promotions.get(key)
    if not promo:
        suggestions = ", ".join(_pretty_key(k) for k in list(promotions.keys())[:10])
        return (
            f"Maaf, promo dengan nama '{promo_key}' tidak ditemukan.\n"
            f"Contoh yang tersedia: {suggestions}"
        )

    # 3) Jika info_type kosong → ringkasan default
    if not info_type:
        desc = promo.get("description") or promo.get("deskripsi")
        header = desc if desc else f"Promo {_pretty_key(key)}"
        return f"{header}\n\nBidang informasi tersedia: {_available_fields(promo)}"

    # 4) Ambil field spesifik
    field = info_type.strip()
    info = promo.get(field)
    if info is None:
        return (
            f"Informasi '{field}' tidak tersedia untuk promo {_pretty_key(key)}. "
            f"Bidang yang ada: {_available_fields(promo)}"
        )

    # 5) Format khusus untuk 'programs'
    if field == "programs" and isinstance(info, list) and all(isinstance(i, dict) for i in info):
        return "Berikut daftar program yang tersedia:\n" + "\n".join(
            [
                f"- {p.get('nama_promo', '-')}: "
                f"min belanja {p.get('minimal_belanja', '-')}, "
                f"cashback {p.get('cashback_nasabah', '-')}, "
                f"reward merchant {p.get('reward_merchant', '-')}"
                for p in info
            ]
        )

    # 6) Format generik
    if isinstance(info, list):
        return _format_list(info)

    if isinstance(info, dict):
        parts = [f"- {_pretty_key(str(k))}: {v}" for k, v in info.items()]
        return "\n".join(parts)

    # String / angka
    return str(info)